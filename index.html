<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>百度地图转高德地图导航</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #f76160;
            --primary-dark: #e6504f;
            --secondary-color: #4285f4;
            --light-bg: #f5f5f5;
            --white: #ffffff;
            --gray-light: #f9f9f9;
            --gray: #ddd;
            --text-dark: #333;
            --text-gray: #666;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-hover: 0 6px 16px rgba(0,0,0,0.12);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--light-bg);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: var(--text-dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-container {
            max-width: 800px;
            width: 100%;
            margin: 30px auto;
            padding: 30px;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .app-container:hover {
            box-shadow: var(--shadow-hover);
        }

        .app-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .app-logo {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

        /* 新增常用路线按钮组样式 */
        .common-route-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .common-route-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .common-route-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .common-route-btn.home {
            background: #17a2b8;
        }

        .common-route-btn.home:hover {
            background: #138496;
        }

        .input-section, .result-section {
            margin-bottom: 30px;
            position: relative;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .section-icon {
            color: var(--secondary-color);
            font-size: 18px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray);
            border-radius: 8px;
            min-height: 140px;
            font-family: monospace;
            resize: vertical;
            font-size: 14px;
            transition: var(--transition);
        }

        textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-icon {
            font-size: 16px;
        }

        .result-area {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 20px;
            transition: var(--transition);
        }

        .result-area:hover {
            background: #f0f0f0;
        }

        #mapLink {
            display: block;
            text-align: center;
            margin-top: 20px;
            padding: 14px;
            background: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: var(--transition);
        }

        #mapLink:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .tip {
            color: var(--text-gray);
            font-size: 14px;
            line-height: 1.6;
            margin-top: 25px;
            padding: 15px;
            background: #f0f7ff;
            border-left: 4px solid var(--secondary-color);
            border-radius: 0 6px 6px 0;
        }

        .error {
            color: #dc3545;
            padding: 15px;
            background: #f8d7da;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            color: var(--text-gray);
            font-size: 13px;
        }

        @media (max-width: 600px) {
            .app-container {
                padding: 20px;
                margin: 15px auto;
            }

            .btn, .common-route-btn {
                width: 100%;
                justify-content: center;
            }

            .btn-group, .common-route-group {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="app-logo">
                <i class="fa fa-map-o" aria-hidden="true"></i>
            </div>
            <h1 class="app-title">百度地图转高德地图导航</h1>
        </div>

        <!-- 新增常用路线按钮组 -->
        <div class="common-route-group">
            <button class="common-route-btn" onclick="openOneWorkRoute()">
                <i class="fa fa-briefcase btn-icon" aria-hidden="true"></i>
                家 ➡️ 广联达一期
            </button>
            <button class="common-route-btn home" onclick="openOneHomeRoute()">
                <i class="fa fa-home btn-icon" aria-hidden="true"></i>
                广联达一期 ➡️ 家
            </button>
        </div>

        <div class="common-route-group">
            <button class="common-route-btn" onclick="openDongWorkRoute()">
                <i class="fa fa-briefcase btn-icon" aria-hidden="true"></i>
                家 ➡️ 东大停车场
            </button>
            <button class="common-route-btn home" onclick="openDongHomeRoute()">
                <i class="fa fa-home btn-icon" aria-hidden="true"></i>
                东大停车场 ➡️ 家
            </button>
        </div>

        <div class="input-section">
            <div class="section-header">
                <i class="fa fa-link section-icon" aria-hidden="true"></i>
                <h2 class="section-title">百度地图链接</h2>
            </div>
            <textarea id="baiduUrl" placeholder="请输入百度地图导航链接（baidumap:// 开头）"></textarea>
        </div>

        <div class="btn-group">
            <button class="btn" onclick="convertUrl()">
                <i class="fa fa-exchange btn-icon" aria-hidden="true"></i>
                转换为高德地图链接
            </button>
            <button class="btn btn-secondary" onclick="clearAll()">
                <i class="fa fa-trash btn-icon" aria-hidden="true"></i>
                清空内容
            </button>
            <!-- 新增：手动更新导航链接按钮 -->
            <button class="btn btn-secondary" onclick="updateMapLink()">
                <i class="fa fa-refresh btn-icon" aria-hidden="true"></i>
                更新导航链接
            </button>
        </div>

        <div class="result-section">
            <div class="section-header">
                <i class="fa fa-compass section-icon" aria-hidden="true"></i>
                <h2 class="section-title">转换结果（高德地图链接）</h2>
            </div>
            <div class="result-area">
                <!-- 移除 readonly 属性，保留 placeholder -->
                <textarea id="amapUrl" placeholder="转换后的高德地图链接将显示在这里"></textarea>
            </div>
        </div>

        <a id="mapLink" href="" style="display: none;">
            <i class="fa fa-map-marker" aria-hidden="true"></i>
            打开高德地图导航
        </a>

        <div class="tip">
            <strong>使用说明：</strong><br>
            1. 在上方输入框粘贴百度地图导航链接（baidumap:// 开头）<br>
            2. 点击"转换为高德地图链接"按钮进行转换<br>
            3. 转换后的链接会显示在结果框中，可手动编辑后点击"更新导航链接"，再点击"打开高德地图导航"即可使用<br>
            4. 支持解析起点、终点和途经点信息并自动转换格式<br>
            5. 可直接点击"去上班"或"回家"按钮快速打开预设路线
        </div>

        <div class="footer">
            <p>地图链接转换工具 &copy; 2023</p>
        </div>
    </div>

    <script>
        // 预设一期上班路线URL
        const WORK_ONE_ROUTE_URL = "amapuri://route/plan/?sourceApplication=wuanrenwen&slat=40.088833&slon=116.316925&dlat=40.051186&dlon=116.28805&dev=0&t=0&vian=10&vialats=40.089899|40.092807|40.061248|40.059563&vialons=116.315908|116.300395|116.300303|116.294816&vianames=途经点2|途经点5|途经点7|途经点8";

        // 预设从一期回家路线URL
        const HOME_ONE_ROUTE_URL = "amapuri://route/plan/?sourceApplication=wuanrenwen&slat=40.051216&slon=116.28836&dlat=40.088833&dlon=116.316925&dev=0&t=0&vian=3&vialats=40.042692|40.042478|40.054709&vialons=116.291656|116.296291|116.328628&vianames=途经点1|途经点2|途经点3";

        // 预设东大上班路线URL
        const WORK_DONG_ROUTE_URL = "amapuri://route/plan/?sourceApplication=wuanrenwen&slat=40.089115&slon=116.31705&dlat=40.05249&dlon=116.28698&dev=0&t=0&vian=9&vialats=40.090758|40.092807|40.061248|40.059563&vialons=116.317308|116.300395|116.300303|116.294816&vianames=途经点1|途经点4|途经点6|途经点7";

        // 预设从东大回家路线URL
        const HOME_DONG_ROUTE_URL = "amapuri://route/plan/?sourceApplication=wuanrenwen&slat=40.05249&slon=116.28698&dlat=40.089115&dlon=116.31705&dev=0&t=0&vian=1&vialats=40.041624&vialons=116.293447&vianames=途经点1";

        // 打开去一期上班路线
        function openOneWorkRoute() {
            // 在结果框显示上班路线URL
            document.getElementById('amapUrl').value = WORK_ONE_ROUTE_URL;
            // 更新导航链接并显示
            const mapLink = document.getElementById('mapLink');
            mapLink.href = WORK_ONE_ROUTE_URL;
            mapLink.style.display = 'block';
            // 跳转到高德地图
            window.location.href = WORK_ONE_ROUTE_URL;
        }

        // 打开从一期回家路线
        function openOneHomeRoute() {
            // 在结果框显示回家路线URL
            document.getElementById('amapUrl').value = HOME_ONE_ROUTE_URL;
            // 更新导航链接并显示
            const mapLink = document.getElementById('mapLink');
            mapLink.href = HOME_ONE_ROUTE_URL;
            mapLink.style.display = 'block';
            // 跳转到高德地图
            window.location.href = HOME_ONE_ROUTE_URL;
        }

        // 打开去东大停车场上班路线
        function openDongWorkRoute() {
            // 在结果框显示上班路线URL
            document.getElementById('amapUrl').value = WORK_DONG_ROUTE_URL;
            // 更新导航链接并显示
            const mapLink = document.getElementById('mapLink');
            mapLink.href = WORK_DONG_ROUTE_URL;
            mapLink.style.display = 'block';
            // 跳转到高德地图
            window.location.href = WORK_DONG_ROUTE_URL;
        }

        // 打开从东大停车场回家路线
        function openDongHomeRoute() {
            // 在结果框显示回家路线URL
            document.getElementById('amapUrl').value = HOME_DONG_ROUTE_URL;
            // 更新导航链接并显示
            const mapLink = document.getElementById('mapLink');
            mapLink.href = HOME_DONG_ROUTE_URL;
            mapLink.style.display = 'block';
            // 跳转到高德地图
            window.location.href = HOME_DONG_ROUTE_URL;
        }

        // 解析百度地图链接并转换为高德地图链接
        function convertUrl() {
            const baiduUrl = document.getElementById('baiduUrl').value.trim();
            const amapUrlInput = document.getElementById('amapUrl');
            const mapLink = document.getElementById('mapLink');
            const errorDiv = document.querySelector('.error');

            // 清除之前的错误信息
            if (errorDiv) errorDiv.remove();

            try {
                // 验证输入不为空
                if (!baiduUrl) {
                    throw new Error('请输入百度地图链接');
                }

                // 1. 解析百度地图参数
                const result = extractBaiduMapCoordinates(baiduUrl);

                // 2. 构建高德地图链接
                let transferUrl = "amapuri://route/plan/?sourceApplication=wuanrenwen" +
                    "&slat=" + encodeURIComponent(result.origin.lat) +
                    "&slon=" + encodeURIComponent(result.origin.lng) +
                    "&dlat=" + encodeURIComponent(result.destination.lat) +
                    "&dlon=" + encodeURIComponent(result.destination.lng) +
                    "&dev=0&t=0";

                // 添加途经点信息
                if (result.viaPointsCount > 0) {
                    transferUrl += "&vian=" + result.viaPointsCount +
                        "&vialats=" + encodeURIComponent(result.viaLats.join('|')) +
                        "&vialons=" + encodeURIComponent(result.viaLngs.join('|')) +
                        "&vianames=" + encodeURIComponent(result.viaNames.join('|'));
                }

                // 显示结果并更新链接
                amapUrlInput.value = transferUrl;
                mapLink.href = transferUrl;
                mapLink.style.display = 'block';

            } catch (e) {
                // 显示错误信息
                const errorElement = document.createElement('div');
                errorElement.className = 'error';
                errorElement.innerHTML = '<i class="fa fa-exclamation-circle" aria-hidden="true"></i>' + e.message;
                document.querySelector('.result-section').after(errorElement);
                mapLink.style.display = 'none';
            }
        }

        // 新增：手动更新导航链接（适配编辑后的内容）
        function updateMapLink() {
            const amapUrlInput = document.getElementById('amapUrl');
            const mapLink = document.getElementById('mapLink');
            const errorDiv = document.querySelector('.error');

            // 清除之前的错误信息
            if (errorDiv) errorDiv.remove();

            const customUrl = amapUrlInput.value.trim();
            if (!customUrl) {
                // 显示错误信息
                const errorElement = document.createElement('div');
                errorElement.className = 'error';
                errorElement.innerHTML = '<i class="fa fa-exclamation-circle" aria-hidden="true"></i>高德地图链接不能为空';
                document.querySelector('.result-section').after(errorElement);
                mapLink.style.display = 'none';
                return;
            }

            // 更新导航链接并显示
            mapLink.href = customUrl;
            mapLink.style.display = 'block';
        }

        // 解析百度地图链接的坐标信息
        function extractBaiduMapCoordinates(url) {
            // 1. 解析URL参数
            const urlParts = url.split('?');
            if (urlParts.length < 2) {
                throw new Error('无效的百度地图链接格式');
            }

            const queryString = urlParts[1];
            const queryParams = {};

            // 解析查询参数
            queryString.split('&').forEach(param => {
                const [key, value] = param.split('=');
                if (key && value) {
                    queryParams[key] = decodeURIComponent(value);
                }
            });

            const result = {};

            // 2. 提取起点坐标
            if (!queryParams.origin) {
                throw new Error('未找到起点参数(origin)');
            }
            const [originLat, originLng] = queryParams.origin.split(',');
            if (!originLat || !originLng) {
                throw new Error('起点坐标格式错误');
            }
            result.origin = { lat: originLat, lng: originLng };

            // 3. 提取终点坐标
            if (!queryParams.destination) {
                throw new Error('未找到终点参数(destination)');
            }
            const [destLat, destLng] = queryParams.destination.split(',');
            if (!destLat || !destLng) {
                throw new Error('终点坐标格式错误');
            }
            result.destination = { lat: destLat, lng: destLng };

            // 4. 提取途经点
            result.viaPointsCount = 0;
            result.viaLats = [];
            result.viaLngs = [];
            result.viaNames = [];

            if (queryParams.viaPoints) {
                try {
                    const viaPointsData = JSON.parse(queryParams.viaPoints);
                    if (viaPointsData.viaPoints && Array.isArray(viaPointsData.viaPoints)) {
                        result.viaPointsCount = viaPointsData.viaPoints.length;
                        viaPointsData.viaPoints.forEach((point, index) => {
                            result.viaLats.push(point.lat);
                            result.viaLngs.push(point.lng);
                            result.viaNames.push(`途经点${index + 1}`);
                        });
                    }
                } catch (e) {
                    throw new Error('途经点解析错误: ' + e.message);
                }
            }

            return result;
        }

        // 清空所有输入
        function clearAll() {
            document.getElementById('baiduUrl').value = '';
            document.getElementById('amapUrl').value = '';
            document.getElementById('mapLink').href = '';
            document.getElementById('mapLink').style.display = 'none';
            const errorDiv = document.querySelector('.error');
            if (errorDiv) errorDiv.remove();
        }
    </script>
</body>
</html>